import{m as O}from"./moment-Z4TjixKs.js";import{u as P,a as J,b as K,c as Q,d as X}from"./use-workflow-BvzxSK-F.js";import{d as A,E as Y,r as F,A as E,x as o,y as m,B as g,w as t,a as d,z as b,f as e,j as V,b as n,u as Z,o as ee,C as te,c as oe,k as ae,h as N,F as le}from"./index-Cb8ybpZu.js";const se={class:"flex items-center justify-between"},ne={class:"text-lg font-bold text-gray-700"},ie={class:"pt-6"},re={class:"flex items-center justify-between"},ce=A({__name:"CreateOrUpdateWorkflowModal",props:{workflow_id:{type:String,default:"",required:!1},visible:{type:Boolean,required:!0},callback:{type:Function,required:!1}},emits:["update:visible","update:workflow_id"],setup(T,{emit:D}){const c=T,U=D,{loading:R,handleCreateWorkflow:x}=P(),{loading:h,handleUpdateWorkflow:$}=J(),{workflow:p,loadWorkflow:z}=K(),{image_url:W,handleUploadImage:w}=Y(),M={fileList:[],icon:"",name:"",tool_call_name:"",description:""},i=F({...M}),r=F(),s=()=>U("update:visible",!1),q=async({errors:f})=>{f||(c.workflow_id?await $(c.workflow_id,i.value):await x(i.value),U("update:visible",!1),c.callback&&c.callback())};return E(()=>c.visible,async f=>{var a,S,v,y,_,k,C;(a=r.value)==null||a.resetFields(),f?c.workflow_id&&(await z(c.workflow_id),i.value={fileList:[{uid:"1",name:"应用图标",url:String((S=p.value)==null?void 0:S.icon)}],icon:String((v=p.value)==null?void 0:v.icon),name:String((y=p.value)==null?void 0:y.name),tool_call_name:String((_=p.value)==null?void 0:_.tool_call_name),description:String((k=p.value)==null?void 0:k.description)}):(i.value=M,(C=r.value)==null||C.resetFields(),U("update:workflow_id",""))}),(f,a)=>{const S=o("icon-close"),v=o("a-button"),y=o("a-upload"),_=o("a-form-item"),k=o("a-input"),C=o("a-textarea"),L=o("a-space"),H=o("a-form"),j=o("a-modal");return m(),g(j,{width:520,visible:c.visible,"hide-title":"",footer:!1,"modal-class":"rounded-xl",onCancel:s},{default:t(()=>[d("div",se,[d("div",ne,b(c.workflow_id===""?"创建工作流":"编辑工作流"),1),e(v,{type:"text",class:"!text-gray-700",size:"small",onClick:s},{icon:t(()=>[e(S)]),_:1})]),d("div",ie,[e(H,{ref_key:"formRef",ref:r,model:i.value,layout:"vertical",onSubmit:q},{default:t(()=>[e(_,{field:"fileList","hide-label":"",rules:[{required:!0,message:"工作流图标不能为空"}]},{default:t(()=>[e(y,{limit:1,"list-type":"picture-card",accept:"image/png, image/jpeg",class:"!w-auto mx-auto","file-list":i.value.fileList,"onUpdate:fileList":a[0]||(a[0]=u=>i.value.fileList=u),"image-preview":"","custom-request":u=>{const{fileItem:I,onSuccess:l,onError:B}=u;return(async()=>{try{await n(w)(I.file),i.value.icon=n(W),l(n(W))}catch(G){B(G)}})(),{abort:()=>{}}},"on-before-remove":async()=>(i.value.icon="",!0)},null,8,["file-list","custom-request","on-before-remove"])]),_:1}),e(_,{field:"name",label:"工作流名称","asterisk-position":"end",rules:[{required:!0,message:"工作流名称不能为空"}]},{default:t(()=>[e(k,{"show-word-limit":"","max-length":50,"model-value":i.value.name,"onUpdate:modelValue":a[1]||(a[1]=u=>i.value.name=u),placeholder:"请输入工作流名称"},null,8,["model-value"])]),_:1}),e(_,{field:"tool_call_name",label:"英文名称","asterisk-position":"end",rules:[{required:!0,message:"英文名称不能为空"}]},{default:t(()=>[e(k,{"show-word-limit":"","max-length":50,"model-value":i.value.tool_call_name,"onUpdate:modelValue":a[2]||(a[2]=u=>i.value.tool_call_name=u),placeholder:"英文名称将用于被大模型识别及调用"},null,8,["model-value"])]),_:1}),e(_,{field:"description",label:"工作流描述","asterisk-position":"end",rules:[{required:!0,message:"工作流描述不能为空"}]},{default:t(()=>[e(C,{"model-value":i.value.description,"onUpdate:modelValue":a[3]||(a[3]=u=>i.value.description=u),"auto-size":{minRows:8,maxRows:8},"max-length":1024,"show-word-limit":"",placeholder:"请输入关于该工作流的描述信息，以便LLM能准确识别工作流的用途。"},null,8,["model-value"])]),_:1}),d("div",re,[a[6]||(a[6]=d("div",{class:""},null,-1)),e(L,{size:16},{default:t(()=>[e(v,{class:"rounded-lg",onClick:s},{default:t(()=>a[4]||(a[4]=[V("取消")])),_:1}),e(v,{loading:n(R)||n(h),type:"primary","html-type":"submit",class:"rounded-lg"},{default:t(()=>a[5]||(a[5]=[V(" 保存 ")])),_:1},8,["loading"])]),_:1})])]),_:1},8,["model"])])]),_:1},8,["visible"])}}}),de={class:"flex items-center gap-3 mb-3"},ue={class:"flex flex-1 justify-between"},_e={class:"flex flex-col"},me={class:"text-xs text-gray-500 line-clamp-1"},pe={class:"leading-[18px] text-gray-500 h-[72px] line-clamp-4 mb-2 break-all"},fe={class:"flex items-center gap-1.5"},ve={class:"text-xs text-gray-400"},be=A({__name:"ListView",props:{createType:{type:String,default:"",required:!0}},emits:["update:create-type"],setup(T,{emit:D}){const c=te(),U=T,R=D,x=F(!1),h=F(""),$=Z(),{loading:p,workflows:z,paginator:W,loadWorkflows:w}=Q(),{handleDeleteWorkflow:M}=X(),i=async r=>{var a;const{scrollTop:s,scrollHeight:q,clientHeight:f}=r.target;if(s+f>=q-10){if(p.value)return;await w(String(((a=c.query)==null?void 0:a.search_word)??""),"")}};return ee(async()=>{var r;await w(((r=c.query)==null?void 0:r.search_word)??"","",!0)}),E(()=>U.createType,r=>{r==="workflow"&&(h.value="",x.value=!0,R("update:create-type",""))}),E(()=>{var r;return(r=c.query)==null?void 0:r.search_word},async()=>{var r;return await w(((r=c.query)==null?void 0:r.search_word)??"","",!0)}),(r,s)=>{const q=o("a-avatar"),f=o("icon-check-circle-fill"),a=o("router-link"),S=o("icon-more"),v=o("a-button"),y=o("a-doption"),_=o("a-dropdown"),k=o("icon-user"),C=o("a-card"),L=o("a-col"),H=o("a-empty"),j=o("a-row"),u=o("a-spin"),I=o("a-space");return m(),g(u,{loading:n(p),class:"block h-full w-full scrollbar-w-none overflow-scroll",onScroll:i},{default:t(()=>[e(j,{gutter:[20,20],class:"flex-1"},{default:t(()=>[(m(!0),oe(le,null,ae(n(z),l=>(m(),g(L,{key:l.id,span:6},{default:t(()=>[e(C,{hoverable:"",class:"cursor-pointer rounded-lg"},{default:t(()=>[d("div",de,[e(q,{size:40,shape:"square","image-url":l.icon},null,8,["image-url"]),d("div",ue,[d("div",_e,[e(a,{to:{name:"space-workflows-detail",params:{workflow_id:l.id}},class:"text-base text-gray-900 font-bold"},{default:t(()=>[V(b(l.name)+" ",1),l.status==="published"?(m(),g(f,{key:0,class:"text-green-700"})):N("",!0)]),_:2},1032,["to"]),d("div",me,b(l.tool_call_name)+" · "+b(l.node_count)+" 节点数 ",1)]),e(_,{position:"br"},{content:t(()=>[e(y,{onClick:()=>{h.value=l.id,x.value=!0}},{default:t(()=>s[2]||(s[2]=[V(" 编辑工作流 ")])),_:2},1032,["onClick"]),e(y,{class:"text-red-700",onClick:async()=>await n(M)(l.id,async()=>{var B;await n(w)(String(((B=n(c).query)==null?void 0:B.search_word)??""),"",!0)})},{default:t(()=>s[3]||(s[3]=[V(" 删除 ")])),_:2},1032,["onClick"])]),default:t(()=>[e(v,{type:"text",size:"small",class:"rounded-lg !text-gray-700"},{icon:t(()=>[e(S)]),_:1})]),_:2},1024)])]),d("div",pe,b(l.description),1),d("div",fe,[e(q,{size:18,class:"bg-blue-700"},{default:t(()=>[e(k)]),_:1}),d("div",ve,b(n($).account.name)+" · 最近编辑 "+b(n(O)(l.created_at).format("MM-DD HH:mm")),1)])]),_:2},1024)]),_:2},1024))),128)),n(z).length===0?(m(),g(L,{key:0,span:24},{default:t(()=>[e(H,{description:"没有可用的工作流",class:"h-[400px] flex flex-col items-center justify-center"})]),_:1})):N("",!0)]),_:1}),n(W).total_page>=2?(m(),g(j,{key:0},{default:t(()=>[n(W).current_page<=n(W).total_page?(m(),g(L,{key:0,span:24,align:"center"},{default:t(()=>[e(I,{class:"my-4"},{default:t(()=>[e(u),s[4]||(s[4]=d("div",{class:"text-gray-400"},"加载中",-1))]),_:1})]),_:1})):(m(),g(L,{key:1,span:24,align:"center"},{default:t(()=>s[5]||(s[5]=[d("div",{class:"text-gray-400 my-4"},"数据已加载完成",-1)])),_:1}))]),_:1})):N("",!0),e(ce,{visible:x.value,"onUpdate:visible":s[0]||(s[0]=l=>x.value=l),workflow_id:h.value,"onUpdate:workflow_id":s[1]||(s[1]=l=>h.value=l),callback:async()=>{var l;return await n(w)(((l=n(c).query)==null?void 0:l.search_word)??"","",!0)}},null,8,["visible","workflow_id","callback"])]),_:1},8,["loading"])}}});export{be as default};
