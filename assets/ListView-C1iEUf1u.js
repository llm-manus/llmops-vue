import{d as te,r as G,G as ie,A as ae,B as C,w as s,x as n,y as c,a as d,z as g,f as e,j as f,b as t,o as re,c as b,C as ce,D as _e,F as ue,k as me,h as ee}from"./index-Dwc_z1ot.js";import{h as pe}from"./moment-C5S46NFB.js";import{m as ge,n as fe,o as ye,d as ve,p as he,q as be,r as xe}from"./use-dataset-BTECfA9z.js";const we={class:"flex items-center justify-between"},ke={class:"text-lg font-bold text-gray-700"},Se={class:"pt-6"},Ce={class:"flex items-center justify-between"},qe=te({__name:"CreateOrUpdateSegmentModal",props:{dataset_id:{type:String,required:!1},document_id:{type:String,required:!1},segment_id:{type:String,required:!1},visible:{type:Boolean,required:!0},callback:{type:Function,required:!1}},emits:["update:visible"],setup(Y,{emit:a}){const r=Y,k=a,{loading:U,handleCreateSegment:y}=ge(),{loading:H,handleUpdateSegment:R}=fe(),{segment:V,loadSegment:D}=ye(),x={content:"",keywords:[]},m=G(x),j=G(),B=ie(()=>r.segment_id&&r.segment_id!==""),_=()=>k("update:visible",!1),o=async({errors:u})=>{u||(B.value?await R(r.dataset_id,r.document_id,r.segment_id,m.value):await y(r.dataset_id,r.document_id,m.value),k("update:visible",!1),r.callback&&r.callback())};return ae(()=>r.visible,async u=>{var l,p;(l=j.value)==null||l.resetFields(),u?B.value&&(await D(r.dataset_id,r.document_id,r.segment_id),m.value.content=V.value.content,m.value.keywords=V.value.keywords):((p=j.value)==null||p.resetFields(),m.value=x)}),(u,l)=>{const p=n("icon-close"),v=n("a-button"),q=n("a-textarea"),S=n("a-form-item"),z=n("a-input-tag"),L=n("a-space"),$=n("a-form"),N=n("a-modal");return c(),C(N,{width:520,visible:r.visible,"hide-title":"",footer:!1,"modal-class":"rounded-xl",onCancel:_},{default:s(()=>[d("div",we,[d("div",ke,g(B.value?"更新":"添加")+"片段 ",1),e(v,{type:"text",class:"!text-gray-700",size:"small",onClick:_},{icon:s(()=>[e(p)]),_:1})]),d("div",Se,[e($,{ref_key:"formRef",ref:j,model:m.value,layout:"vertical",onSubmit:o},{default:s(()=>[e(S,{field:"content",label:"片段内容","asterisk-position":"end",rules:[{required:!0,message:"片段内容不能为空"}]},{default:s(()=>[e(q,{"model-value":m.value.content,"onUpdate:modelValue":l[0]||(l[0]=F=>m.value.content=F),"auto-size":{minRows:8,maxRows:8},placeholder:"在这里添加文档片段内容"},null,8,["model-value"])]),_:1}),e(S,{field:"keywords",label:"关键词"},{default:s(()=>[e(z,{"model-value":m.value.keywords,"onUpdate:modelValue":l[1]||(l[1]=F=>m.value.keywords=F),"max-tag-count":10,placeholder:"请输入该文档片段关键词，最多不超过10个，按Enter输入"},null,8,["model-value"])]),_:1}),d("div",Ce,[l[4]||(l[4]=d("div",{class:""},null,-1)),e(L,{size:16},{default:s(()=>[e(v,{class:"rounded-lg",onClick:_},{default:s(()=>l[2]||(l[2]=[f("取消")])),_:1}),e(v,{loading:t(H)||t(U),type:"primary","html-type":"submit",class:"rounded-lg"},{default:s(()=>l[3]||(l[3]=[f(" 保存 ")])),_:1},8,["loading"])]),_:1})])]),_:1},8,["model"])])]),_:1},8,["visible"])}}}),ze={class:"px-6 pt-6 flex flex-col overflow-hidden h-full"},Ue={class:"sticky top-0 z-20 bg-gray-50"},Ve={class:"flex items-center w-full gap-2 mb-6"},De={class:"flex items-center gap-3"},je={class:"flex flex-col justify-between h-[40px]"},Be={key:1,class:"text-gray-700"},Fe={key:2,class:"flex items-center gap-2"},Me={key:3,class:"flex items-center gap-2"},Re={class:"flex items-center justify-between mb-6"},$e={class:"flex items-center gap-2 h-8 leading-8 bg-white rounded-lg px-3 text-gray-700 border"},Ee={key:0,class:"w-2 h-2 bg-green-500 border border-green-700 rounded-sm"},Ge={key:1,class:"w-2 h-2 bg-gray-500 border border-gray-200 rounded-sm"},He={class:"flex items-center justify-between mb-2"},Le={class:"flex items-center"},Ne={class:"flex items-center gap-1 text-xs text-gray-700"},Ye={key:0,class:"w-2 h-2 bg-green-500 border border-green-700 rounded-sm"},Oe={key:1,class:"w-2 h-2 bg-gray-500 border border-gray-700 rounded-sm"},Te=["onClick"],Ae={class:"flex items-center justify-between"},Ie={class:"flex items-center gap-3"},Pe={class:"flex items-center gap-1 text-xs text-gray-500"},We={class:"flex items-center gap-1 text-xs text-gray-500"},Xe=te({__name:"ListView",setup(Y){const a=ce(),r=_e(),k=G(!1),U=G(""),{document:y,loadDocument:H}=ve(),{loading:R,segments:V,paginator:D,loadSegments:x}=he(),{handleDelete:m}=be(),{handleUpdate:j}=xe(),B=async _=>{var p,v,q;const{scrollTop:o,scrollHeight:u,clientHeight:l}=_.target;if(o+l>=u-10){if(R.value)return;await x(String((p=a.params)==null?void 0:p.dataset_id),String((v=a.params)==null?void 0:v.document_id),!1,String(((q=a.query)==null?void 0:q.search_word)??""))}};return ae(()=>{var _;return(_=a.query)==null?void 0:_.search_word},_=>{var o,u;return x(String((o=a.params)==null?void 0:o.dataset_id),String((u=a.params)==null?void 0:u.document_id),!0,String(_))}),re(()=>{var _,o,u,l,p;H(String((_=a.params)==null?void 0:_.dataset_id),String((o=a.params)==null?void 0:o.document_id)),x(String((u=a.params)==null?void 0:u.dataset_id),String((l=a.params)==null?void 0:l.document_id),!0,String(((p=a.query)==null?void 0:p.search_word)??""))}),(_,o)=>{var A,I,P,W,J,K,Q;const u=n("icon-left"),l=n("a-button"),p=n("router-link"),v=n("icon-file"),q=n("a-avatar"),S=n("a-skeleton-line"),z=n("a-tag"),L=n("a-input-search"),$=n("a-space"),N=n("a-divider"),F=n("a-switch"),se=n("icon-bookmark"),ne=n("icon-pushpin"),oe=n("icon-delete"),le=n("a-card"),E=n("a-col"),de=n("a-empty"),O=n("a-row"),T=n("a-spin");return c(),b("div",ze,[d("div",Ue,[d("div",Ve,[e(p,{to:{name:"space-datasets-documents-list",params:{dataset_id:(A=t(a).params)==null?void 0:A.dataset_id,document_id:(I=t(a).params)==null?void 0:I.document_id}}},{default:s(()=>[e(l,{size:"mini",type:"text",class:"!text-gray-700"},{icon:s(()=>[e(u)]),_:1})]),_:1},8,["to"]),d("div",De,[e(q,{size:40,shape:"square",class:"rounded-lg bg-blue-700"},{default:s(()=>[e(v)]),_:1}),d("div",je,[(P=t(y))!=null&&P.name?(c(),b("div",Be,"文档 / "+g(t(y).name),1)):(c(),C(S,{key:0,widths:[100]})),(W=t(y))!=null&&W.name?(c(),b("div",Me,[e(z,{size:"small",class:"rounded h-[18px] leading-[18px] bg-gray-200 text-gray-500"},{default:s(()=>[f(g(t(y).segment_count)+" 文档片段 ",1)]),_:1}),e(z,{size:"small",class:"rounded h-[18px] leading-[18px] bg-gray-200 text-gray-500"},{default:s(()=>[f(g(t(y).hit_count)+" 命中 ",1)]),_:1}),e(z,{size:"small",class:"rounded h-[18px] leading-[18px] bg-gray-200 text-gray-500"},{default:s(()=>[f(g(t(pe)(t(y).updated_at*1e3).format("YYYY-MM-DD HH:mm"))+" 最后编辑 ",1)]),_:1})])):(c(),b("div",Fe,[e(S,{widths:[60],"line-height":18}),e(S,{widths:[60],"line-height":18}),e(S,{widths:[60],"line-height":18})]))])])]),d("div",Re,[e(L,{"default-value":((J=t(a).query)==null?void 0:J.search_word)||"",placeholder:"请输入关键词搜索片段",class:"w-[240px] bg-white rounded-lg border-gray-200",onSearch:o[0]||(o[0]=i=>{t(r).push({path:t(a).path,query:{search_word:i}})})},null,8,["default-value"]),e($,{size:12},{default:s(()=>[d("div",$e,[t(y).enabled?(c(),b("div",Ee)):(c(),b("div",Ge)),f(" "+g(t(y).enabled?"可用":"已禁用"),1)]),e(l,{type:"primary",class:"rounded-lg",onClick:o[1]||(o[1]=()=>{k.value=!0,U.value=""})},{icon:s(()=>[e(v)]),default:s(()=>[o[3]||(o[3]=f(" 添加片段 "))]),_:1})]),_:1})])]),e(T,{loading:t(R),class:"block h-full w-full scrollbar-w-none overflow-scroll",onScroll:B},{default:s(()=>[e(O,{gutter:[20,20]},{default:s(()=>[(c(!0),b(ue,null,me(t(V),i=>(c(),C(E,{key:i.id,span:6},{default:s(()=>[e(le,{hoverable:"",class:"cursor-pointer rounded-lg"},{default:s(()=>[d("div",He,[e(z,{size:"small",class:"rounded-md text-gray-500"},{default:s(()=>[f(" #"+g(i.position.toString().padStart(3,"0")),1)]),_:2},1024),d("div",Le,[d("div",Ne,[f(g(i.enabled?"已启用":"已禁用")+" ",1),i.enabled?(c(),b("div",Ye)):(c(),b("div",Oe))]),e(N,{direction:"vertical"}),e(F,{"model-value":i.enabled,"onUpdate:modelValue":h=>i.enabled=h,"checked-color":"#10b981","unchecked-color":"#556581",disabled:i.status!=="completed",onChange:async h=>{var w,M;return await t(j)((w=t(a).params)==null?void 0:w.dataset_id,(M=t(a).params)==null?void 0:M.document_id,i.id,h)},type:"round",size:"small"},null,8,["model-value","onUpdate:modelValue","disabled","onChange"])])]),d("div",{class:"leading-[18px] text-gray-700 h-[72px] line-clamp-4 mb-2 break-all",onClick:()=>{U.value=i.id,k.value=!0}},g(i.content),9,Te),d("div",Ae,[d("div",Ie,[d("div",Pe,[e(se),f(" "+g(i.character_count)+" 字符 ",1)]),d("div",We,[e(ne),f(" "+g(i.hit_count)+" 命中 ",1)])]),e(l,{type:"text",size:"mini",class:"!text-gray-500",onClick:async()=>{var h,w;return await t(m)((h=t(a).params)==null?void 0:h.dataset_id,(w=t(a).params)==null?void 0:w.document_id,i.id,()=>{var M,X,Z;return t(x)(String((M=t(a).params)==null?void 0:M.dataset_id),String((X=t(a).params)==null?void 0:X.document_id),!0,String(((Z=t(a).query)==null?void 0:Z.search_word)??""))})}},{icon:s(()=>[e(oe)]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128)),t(V).length===0?(c(),C(E,{key:0,span:24},{default:s(()=>[e(de,{description:"没有可用的文档片段",class:"h-[400px] flex flex-col items-center justify-center"})]),_:1})):ee("",!0)]),_:1}),t(D).total_page>=2?(c(),C(O,{key:0},{default:s(()=>[t(D).current_page<=t(D).total_page?(c(),C(E,{key:0,span:24,align:"center"},{default:s(()=>[e($,{class:"my-4"},{default:s(()=>[e(T),o[4]||(o[4]=d("div",{class:"text-gray-400"},"加载中",-1))]),_:1})]),_:1})):(c(),C(E,{key:1,span:24,align:"center"},{default:s(()=>o[5]||(o[5]=[d("div",{class:"text-gray-400 my-4"},"数据已加载完成",-1)])),_:1}))]),_:1})):ee("",!0)]),_:1},8,["loading"]),e(qe,{visible:k.value,"onUpdate:visible":o[2]||(o[2]=i=>k.value=i),dataset_id:(K=t(a).params)==null?void 0:K.dataset_id,document_id:(Q=t(a).params)==null?void 0:Q.document_id,segment_id:U.value,callback:()=>{var i,h,w;return t(x)(String((i=t(a).params)==null?void 0:i.dataset_id),String((h=t(a).params)==null?void 0:h.document_id),!0,String(((w=t(a).query)==null?void 0:w.search_word)??""))}},null,8,["visible","dataset_id","document_id","segment_id","callback"])])}}});export{Xe as default};
